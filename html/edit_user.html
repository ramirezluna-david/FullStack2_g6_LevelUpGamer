<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar usuario</title>
      <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <link rel="stylesheet" href="../assets/css/new_user.css">
</head>
<body>
    <!--Perfil del administrador-->
    <div class="sidebar">
        <h2>Level-Up Gamer (Administrator)</h2>
        <ul class="menu">
            <li><a href="../html/producto.html"> <i class="bi bi-bag-check"></i>Productos</a></li>
            <li><a href="../html/usuario.html"><i class="bi bi-people"></i>Usuario</a></li>
        </ul>
        <ul class="menu bottom-menu">
            <li><a href="../html/admin.html">Inicio</a></li>
            <li><a href="">Configuración</a></li>
            <li><a href="">Ayuda</a></li>
            <li><a href="">Perfil</a></li>
            <li><a href="">Cerrar Sesión</a></li>
        </ul>
    </div>
    <div class="content">
        <div class="topbar">
            <h1>Crear nuevo usuario</h1>
            <i class="bi bi-bell-fill"></i>
        </div>

        <form id="form_editar_usuario" novalidate>

            <label for="nombre">Nombre*</label>
            <input type="name" id="nombre" placeholder="Ingrese el nombre.">

            <label for="apellido">Apellidos*</label>
            <input type="name" id="apellido" placeholder="Ingrese los apellidos.">

            <label for="email">Email*</label>
            <input type="email" id="email" placeholder="Ingrese su Email">

            <label for="fecha_nacimiento">Fecha de nacimiento (Opcional)</label>
            <input type="date" id="fecha_nacimiento" placeholder="Ingrese la fecha de nacimiento">
            <div class="selection">
                <label for="user">Seleccione el tipo de usuario*:</label>
                <select name="user" id="user">
                    <option value="">--Seleccione el tipo de usuario.--</option>
                    <option value="administrador">Admnistrador</option>
                    <option value="cliente">Cliente</option>
                    <option value="vendedor">Vendedor</option>
                </select>
            

            
                <label for="region">Seleccione una región*:</label>
                <select name="region" id="region">
                    <option value="metropolitana">Región Metropolitana</option>
                    <option value="araucania">Región de la Araucanía</option>
                    <option value="nuble">Región de Ñuble</option>
                </select>
            

            
                <label for="comuna">Seleccione una comuna*:</label>
                <select name="comuna" id="comuna">
                    <option value="">--Seleccione una comuna--</option>
                </select>
                
                <label for="direccion">Dirección*</label>
                <input type="text" id="direccion" placeholder="Ingrese la dirección.">
            </div>

            <button type="submit">Agregar</button>
            <a href="usuario.html" class="btn btn-secondary">Cancelar</a>
            <p id="mensaje_error" style="color: red;"></p>
            <p id="email_error" style="color: red;"></p>
        </form>
    <script>
        const region_select = document.getElementById("region");
        const comuna_select = document.getElementById("comuna");
        const comuna_region = {
        metropolitana : ["Santiago"],
        araucania : ["Temuco"],
        nuble : ["chillan"]
            };

        region_select.addEventListener("change", function (){
            const region = region_select.value;

            comuna_select.innerHTML = '<option value="">--Seleccione una comuna--</option>';

            if (region && comuna_region[region]){
                comuna_region[region].forEach(comuna =>{
                    const option = document.createElement("option");
                    option.value = comuna.toLowerCase();
                    option.textContent = comuna;
                    comuna_select.appendChild(option);
                })
            }
        });
        const rut_edit = localStorage.getItem("usuario_edit");
        let usuarios = JSON.parse(localStorage.getItem("usuarios")) || [];
        const usuario = usuarios.find(u => u.rut === rut_edit);

        if (usuario){
            document.getElementById("nombre").value = usuario.nombre;
            document.getElementById("apellido").value = usuario.apellido;
            document.getElementById("email").value = usuario.email;
            document.getElementById("fecha_nacimiento").value = usuario.fecha_nacimiento;
            document.getElementById("user").value = usuario.user;
            document.getElementById("region").value = usuario.region;
            document.getElementById("comuna").value = usuario.comuna;
            document.getElementById("direccion").value = usuario.direccion;
        }
        document.getElementById("form_editar_usuario").addEventListener("submit", function(evento){
            evento.preventDefault();
            usuario.nombre = document.getElementById("nombre").value;
            usuario.apellido = document.getElementById("apellido").value;
            usuario.email = document.getElementById("email").value;
            usuario.fecha_nacimiento = document.getElementById("fecha_nacimiento").value;
            usuario.user = document.getElementById("user").value;
            usuario.region = document.getElementById("region").value;
            usuario.comuna = document.getElementById("comuna").value;
            usuario.direccion = document.getElementById("direccion").value;
            //actualizar el localstorage
            localStorage.setItem("usuarios", JSON.stringify(usuarios));

            alert("Usuario editado con exito!");
            window.location.href = "usuario.html";
        });

    </script>
    </div>
</body>
</html>